{% extends '@Forum/layout.html.twig' %}

{% block body %}




<section class="postSectionIndex">

{#-------------------------------------------------------------#}
{# NavBar Lateral  #}
{{ include("@Forum/post/postNavBar.html.twig") }}
{# fin rating user #}
{#-------------------------------------------------------------#}


  {# DEBUT CODE #}
  <article class="postArticleIndex">
    <h1 class="center">Discussions par catégorie</h1>

    <ul class="collapsible popout postDivPrincipale" data-collapsible="popout">
      {#***********************#}
      {# Niveau 1 : Catégories #}
      {#***********************#}
        {% set img = 1 %}
      {% for categorie in categories %}
      <li>
          <div class="collapsible-header postListTitleCat">
            {{ categorie.nom }}
            {# Stockage de l'ID de la CATEGORIE #}
            {% set categorieEnLecture = categorie.id %}
              {# Reprise image categorie du harasBundle #}
              <div><img class="indexImageCat" src="{{ asset('bundles/haras/media/section' ~ img ~ 'Image.png') }}"></div>
          </div>
          <div class="collapsible-body">
            <ul class="collapsible popout postDivPrincipale" data-collapsible="accordion">
            {#****************************#}
            {# Niveau 2 : SOUS CATEGORIES #}
            {#****************************#}
            {% for sousCategorie in sousCategories %}
            {# Selectionne sous catégorie  parentId not null #}
            {% if sousCategorie.parent.id == categorieEnLecture %}
                <li class="liPostSousCat">
                   <div class="collapsible-header postListTitleSousCat ">
                       <i class="fa fa-bars" aria-hidden="true"></i>
                       {{ sousCategorie.nom }}
                       {# Stockage de l'ID de la SOUS CATEGORIE #}
                       {% set sousCategorieEnLecture = sousCategorie.id %}
                   </div>
                   <div class="collapsible-body divCorpsSousCat">
                       <ul class="collapsible popout col offset-l2 l8 s12 m6 postDivPrincipale" data-collapsible="accordion">
                       {#**************************}
                       {# Niveau 3 : Post Parents #}
                       {#*************************#}
                       {% for postParent in postParents %}
                       {# Selectionne sous categorieId du postParent #}
                       {% if (postParent.categorie.id == sousCategorieEnLecture)
                            and (postParent.categorie.parent.id == categorieEnLecture) %}
                            <li>
                                  <div class="collapsible-header postListTitlePost" id="table_id"">
                                      <i class="material-icons">place</i>
                                      {{ postParent.titre }}
                                  </div>
                                  <div class="collapsible-body divCorpsPostParent">
                                      <div class="bigtxt">
                                        <p>{{ postParent.contenu|raw }}</p>
                                      </div>
                                      <div class="cartoucheUserIndexPost center">
                                        <p class="pCartoucheUserIndexPost">Message de : {{ postParent.user }}</p>
                                        <p class="avatarUserIndex"><img src="{{ asset('bundles/haras/images/test2.jpeg') }}"></p>
                                        {#-------------------------------------------------------------#}
                                        {# rating user #}
                                        {#<p>{{ postParent.user.nbPost }}</p>#}
                                        {% set nb = 100 %}
                                        <p class="pCartoucheUserIndexPost">{{ include("@Forum/post/rating.html.twig") }}</p>
                                        {# fin rating user #}
                                        {#-------------------------------------------------------------#}
                                      </div>
                                      <a class="waves-effect waves-teal btn-flat center indexEntrerFil"
                                           href="{{ path('post_showAllPost', { 'id': postParent.id }) }}">
                                            <i class="material-icons">input</i>
                                      </a>
                                  </div> {# fin class="collapsible-body" POSTPARENT #}
                            </li>
                       {% endif %}  {# fin if POST PARENT #}
                       {% endfor %} {# for for POST PARENT #}
                       </ul>
                   <div class="row center">
                       {#Ajout nouveau post parent sur cat & ssCat selectionnées (CAT)#}
                       <a class="btn btn-small waves-effect waves-light grey darken-3"
                           href="{{ path('post_newParent' , {'cat' : sousCategorieEnLecture}) }}">
                            <i class="material-icons">add</i>
                       </a>
                       {#-------------------------------------------------------------#}
                        {# Mise en place pagination #}
                        {#<div class="row center">#}
                            {#{{ knp_pagination_render(postParents) }}#}
                        {#</div>#}
                        {#-------------------------------------------------------------#}
                   </div>
            {% endif %} {# fin if SOUS CATEGORIE #}
            {% endfor %} {# fin for SOUS CATEGORIE #}
                   </div> {# Fin Div  class="collapsible-body" niveau POST PARENTS #}
                </li>
            </ul>
          </div> {# fin class="collapsible-body" SOUS CATEGORIES #}
      </li>
      {% set img = img + 1 %}
      {% endfor %} {# fin for CATEGORIE #}
    </ul>


    {# Bouton création nouveau fil de discussion sur cat et ssCat ou il se trouve #}
    {#<div class="row center">#}
        {#<a class="btn-floating btn-large waves-effect waves-light green darken-3"#}
            {#href="{{ path('post_new' , {'cat' : postParent.categorie.id, 'id' : NULL }) }}">#}
            {#<i class="material-icons">+</i>#}
        {#</a>#}
    {#</div>#}
   </article>
</section>
{% endblock %}
